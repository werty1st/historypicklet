(()=>{var d="./window-5VJUUJNB.html";(async function(){let c="https://werty1st.github.io/historypicklet/dist";console.log("injected"),console.log(d);let u=window.open(`${c}/${d}`,"Custom Picks","width=300,height=600,scrollbars=1,resizable=1");function m(){let t={},o=zdfsite.user;t["Api-Auth"]="Bearer "+zdfsite.apiToken;let s=o.getState().token;return s&&!o.getState().profile.deactivatePersonalRecommendations&&(t.Authorization=`Bearer ${s}`),t["Content-Type"]="application/x-www-form-urlencoded",t}async function f(t){let o={};o.method="GET",o.headers=m();let s=`https://api.zdf.de/content/embed/${t}.json?profile=player2`,e=await fetch(s,o);return e.ok?{doc:await e.json(),err:null}:(console.error(`${e.status} - ${e.statusText} (for url ${s})`),{doc:null,err:e.status})}async function p(t,o){console.log(`Name: ${o}, ID: ${t}`),u.postMessage({history:o,externalId:t,datatype:"json"},c)}async function y(){let t=zdfsite.user.getPlaybackHistory().getItems().sort(({eventDate:e},{eventDate:n})=>(r,i)=>(new Date(i)-new Date(r))(r,i)),s=!1?t.slice(0,4):t;for await(let e of s){let n=localStorage.getItem(e.externalId);if(n==null||n=="{}"||n==""){let{doc:r,err:i}=await f(e.externalId);if(r){let a=JSON.stringify({leadParagraph:r.leadParagraph,title:r.title});localStorage.setItem(e.externalId,a),p(e.externalId,a)}}else try{let r=JSON.parse(n);console.log(r),p(e.externalId,n)}catch(r){localStorage.removeItem(e.externalId)}}}async function h(t){alert(`No history picks for ${t}`)}async function w(t){console.log("reload ID",t),window.XCustomID=t;let o="34e6008c-7c5c-402e-ace9-fd3e247f6d97";var s=[{externalId:t,eventDate:"2021-05-24T13:27:05Z",currentPosition:99}];let e=encodeURIComponent(JSON.stringify(s)),n=new DOMParser,r=`
        <div class="js-rb-live" data-recommendation-cluster-list-uri="/broker/relay?plays=${e}&amp;appId={appId}&amp;abGroup={abGroup}&amp;preferences={preferences}&amp;profile=minimal&amp;configuration=history-picks&amp;pageId=SCMS_2fd1b340-e4db-47f2-b55b-633ac4ed1dba&amp;clusterLimit=1"
         data-module="recommendation-cluster-list"
         data-recommendation-cluster-list-nodeid="${o}">
        </div>
        `,a=n.parseFromString(r,"text/html").querySelector("div"),l;(l=document.querySelector(`article[data-node-id="${o}"]`))?l.replaceWith(a):(l=document.querySelector(".sb-page > article"),l.nextElementSibling.prepend(a))}async function g(){y()}function b(){if(window.l1?(window.l1=!0,console.log("parent listener exists")):(window.addEventListener("message",s=>{if(s.origin==c)try{let e=JSON.parse(s.data);e.message==="ready"?g():e.message==="reload"&&w(e.id)}catch(e){console.error("Payload not json")}},!1),console.log("parent listener installed")),window.f1)console.warn("fetch installed");else{var t=/^https:\/\/(api|zdf-int-api)\.(zdf)\.de\/broker\/relay/,o=window.fetch;window.fetch=async function(){let s=arguments[0];if(t.test(s)){let n=window.XCustomID;var e=await o.apply(this,arguments);return e.status!=200&&h(n),Promise.resolve(e)}return o.apply(this,arguments)},window.f1=!0}}b()})();})();
//# sourceMappingURL=app.js.map
